<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Puppy Multiplication ‚Äî Sporty Edition + Manifest</title>
  <meta name="description" content="Sporty multiplication practice with curated puppy photo manifest and full 1‚Äì12 coverage." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, sans-serif; background: #0f1020; color: #fff; }
    .card { background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.1);
            border-radius:1.25rem; padding:1.25rem; margin-bottom:1rem; }
    .btn { display:inline-flex; align-items:center; justify-content:center;
           padding:0.6rem 1rem; border-radius:0.8rem;
           background:linear-gradient(135deg,#8E59FF,#FF5FD2); color:#fff; font-weight:700; cursor:pointer; }
    .btn-secondary { background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); }
    .kbd { user-select:none; display:inline-flex; align-items:center; justify-content:center;
           border-radius:0.6rem; border:1px solid rgba(255,255,255,0.2);
           padding:0.6rem 0.8rem; font-size:1.1rem; font-weight:800;
           background: rgba(255,255,255,0.08); color:#fff; cursor:pointer; }
    .tile { border-radius:0.8rem; overflow:hidden; border:1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.04); }
    .tile img { width:100%; height:120px; object-fit:cover; display:block; }
    .gallery { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px;
               max-height:420px; overflow:auto; }
    .bar { height:10px; width:100%; background:rgba(255,255,255,0.12); border-radius:999px; overflow:hidden; }
    .bar > div { height:100%; width:0%; background: linear-gradient(90deg, #8E59FF, #FF5FD2); }
  </style>
</head>
<body>
  <div class="card">
    <h1 class="text-2xl font-bold mb-2">üê∂ Puppy Multiplication</h1>
    <p class="mb-4">Practice 1‚Äì12 √ó 1‚Äì12 with sporty style. Each correct answer shows a puppy photo from your manifest.</p>
    <div id="tables" class="grid grid-cols-6 gap-2 mb-3"></div>
    <div class="flex gap-2 mb-4">
      <button id="selectAll" class="btn-secondary btn">All 1‚Äì12</button>
      <button id="clearAll" class="btn-secondary btn">Clear</button>
      <button id="startBtn" class="btn">Start</button>
    </div>
    <div id="game" style="display:none;">
      <div class="flex justify-between items-center mb-3">
        <div>Score <span id="score">0</span>/<span id="total">0</span></div>
        <div class="bar"><div id="prog"></div></div>
      </div>
      <div class="text-center mb-4">
        <div id="q" class="text-3xl font-bold mb-2">6 √ó 7 = ?</div>
        <input id="ans" inputmode="numeric" class="kbd w-24 text-center" placeholder="?">
        <button id="submit" class="btn">Submit</button>
        <button id="skip" class="btn-secondary btn">Skip</button>
        <div id="fb" class="mt-2"></div>
      </div>
      <div id="gal" class="gallery"></div>
    </div>
  </div>

  <script>
    let MANIFEST = [];
    async function loadManifest(){
      try {
        const resp = await fetch('./puppy-image-manifest.json', {cache:'no-store'});
        if (resp.ok) { MANIFEST = await resp.json(); console.log("Loaded manifest:", MANIFEST.length); }
      } catch(e){ console.error("Manifest load failed", e); }
    }
    loadManifest();

    const tablesWrap = document.getElementById('tables');
    const selected = new Set();
    for (let i=1;i<=12;i++){
      const b=document.createElement('button');
      b.textContent=i; b.className='kbd';
      b.onclick=()=>{ if(selected.has(i)){selected.delete(i);b.style.outline='none';}else{selected.add(i);b.style.outline='2px solid #8BF5CE';} };
      tablesWrap.appendChild(b);
    }
    document.getElementById('selectAll').onclick=()=>{selected.clear();for(let i=1;i<=12;i++)selected.add(i);
      [...tablesWrap.children].forEach(b=>b.style.outline='2px solid #8BF5CE');};
    document.getElementById('clearAll').onclick=()=>{selected.clear();[...tablesWrap.children].forEach(b=>b.style.outline='none');};

    const qEl=document.getElementById('q'),ansEl=document.getElementById('ans'),fb=document.getElementById('fb'),
          gal=document.getElementById('gal'),scoreEl=document.getElementById('score'),totalEl=document.getElementById('total'),
          prog=document.getElementById('prog'),game=document.getElementById('game');
    let questions=[],cursor=0,score=0;

    function makePairs(tables){const out=[];for(const a of tables){for(let b=1;b<=12;b++)out.push({a,b,ans:a*b});}return out;}
    function findImage(a,b){const r=MANIFEST.find(x=>Number(x.a)===a&&Number(x.b)===b)||MANIFEST.find(x=>Number(x.a)===b&&Number(x.b)===a);
      return r?{url:r.image_url,label:r.label}:{url:"",label:""};}
    function addTile(src,label){const d=document.createElement('div');d.className='tile';const i=document.createElement('img');
      i.src=src||'https://images.unsplash.com/photo-1548199973-03cce0bbc87b?q=80&w=800&auto=format&fit=crop';i.alt=label||'Puppy';d.appendChild(i);gal.prepend(d);}
    function nextQ(){if(cursor>=questions.length){fb.textContent='All done!';return;}const q=questions[cursor];qEl.textContent=`${q.a} √ó ${q.b} = ?`;prog.style.width=Math.round(cursor/questions.length*100)+'%';fb.textContent='';ansEl.value='';}
    function submit(){const raw=ansEl.value.trim(),val=Number(raw);if(!raw||isNaN(val)){fb.textContent='Type a number';return;}
      const q=questions[cursor];if(val===q.ans){score++;scoreEl.textContent=score;const m=findImage(q.a,q.b);addTile(m.url,m.label);fb.textContent='Nice!';}
      else{fb.textContent=`Close! ${q.a} √ó ${q.b} = ${q.ans}.`;}cursor++;nextQ();}

    document.getElementById('submit').onclick=submit;
    document.getElementById('skip').onclick=()=>{cursor++;nextQ();};
    ansEl.addEventListener('keydown',e=>{if(e.key==='Enter')submit();});
    document.getElementById('startBtn').onclick=()=>{
      if(selected.size===0){alert('Pick at least one table.');return;}
      questions=makePairs([...selected]);questions.sort(()=>Math.random()-0.5);cursor=0;score=0;scoreEl.textContent='0';totalEl.textContent=questions.length;
      gal.innerHTML='';game.style.display='block';nextQ();ansEl.focus();};
  </script>
</body>
</html>